{% extends 'vacancies/base.html' %}

{% block title %}–ö–∞—Ç–∞–ª–æ–≥ –≤–∞–∫–∞–Ω—Å–∏–π - HH API{% endblock %}

{% block content %}
<div class="card">
    <h2>–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã</h2>
    <form method="get" action="{% url 'vacancies:vacancy_list' %}">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div class="form-group">
                <label for="search">–ü–æ–∏—Å–∫:</label>
                <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ...">
            </div>
            
            <div class="form-group">
                <label for="area">–ì–æ—Ä–æ–¥:</label>
                <select id="area" name="area">
                    <option value="">–í—Å–µ –≥–æ—Ä–æ–¥–∞</option>
                    {% for area in areas %}
                    <option value="{{ area }}" {% if area == area_filter %}selected{% endif %}>{{ area }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="experience">–û–ø—ã—Ç:</label>
                <select id="experience" name="experience">
                    <option value="">–õ—é–±–æ–π</option>
                    {% for exp in experiences %}
                    <option value="{{ exp }}" {% if exp == experience_filter %}selected{% endif %}>{{ exp }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="employment">–ó–∞–Ω—è—Ç–æ—Å—Ç—å:</label>
                <select id="employment" name="employment">
                    <option value="">–õ—é–±–∞—è</option>
                    {% for emp in employments %}
                    <option value="{{ emp }}" {% if emp == employment_filter %}selected{% endif %}>{{ emp }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="schedule">–ì—Ä–∞—Ñ–∏–∫:</label>
                <select id="schedule" name="schedule">
                    <option value="">–õ—é–±–æ–π</option>
                    {% for sch in schedules %}
                    <option value="{{ sch }}" {% if sch == schedule_filter %}selected{% endif %}>{{ sch }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="professional_role">–ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏:</label>
                <select id="professional_role" name="professional_role">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for role in professional_roles %}
                    <option value="{{ role }}" {% if role == professional_role_filter %}selected{% endif %}>{{ role }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <label for="salary">–ú–∏–Ω. –∑–∞—Ä–ø–ª–∞—Ç–∞:</label>
                <input type="number" id="salary" name="salary" value="{{ salary_filter }}" placeholder="–†—É–±–ª–µ–π">
            </div>
        </div>
        
        <div style="margin-top: 15px;">
            <button type="submit" class="btn">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
            <a href="{% url 'vacancies:vacancy_list' %}" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
        </div>
    </form>
</div>

<div style="margin-bottom: 15px;">
    <strong>–ù–∞–π–¥–µ–Ω–æ –≤–∞–∫–∞–Ω—Å–∏–π: {{ total_count }}</strong>
</div>

{% if vacancies %}
    {% for vacancy in vacancies %}
    <div class="card" style="cursor: pointer;" onclick="window.location.href='{% url 'vacancies:vacancy_detail' vacancy.id %}'">
        <div style="display: flex; justify-content: space-between; align-items: start; gap: 20px;">
            {% if vacancy.employer_logo_url %}
            <div style="flex-shrink: 0;">
                <img src="{{ vacancy.employer_logo_url }}" alt="{{ vacancy.employer_name }}" 
                     style="width: 80px; height: 80px; object-fit: contain; border-radius: 8px; background: #f8f9fa; padding: 5px;">
            </div>
            {% endif %}
            <div style="flex: 1;">
                <h3 style="margin-bottom: 10px; color: #667eea;">
                    <a href="{% url 'vacancies:vacancy_detail' vacancy.id %}" style="text-decoration: none; color: inherit;">
                        {{ vacancy.name }}
                    </a>
                </h3>
                <p style="color: #666; margin-bottom: 10px;">
                    <strong>{{ vacancy.employer_name }}</strong>
                    {% if vacancy.area_name %} ‚Ä¢ {{ vacancy.area_name }}{% endif %}
                </p>
                {% if vacancy.professional_role %}
                <p style="color: #667eea; margin-bottom: 10px; font-size: 14px;">
                    üìã {{ vacancy.professional_role }}
                </p>
                {% endif %}
                
                {% if vacancy.salary_from or vacancy.salary_to %}
                <p style="color: #28a745; font-weight: 500; margin-bottom: 10px;">
                    {% if vacancy.salary_from and vacancy.salary_to %}
                        {{ vacancy.salary_from|floatformat:0 }} - {{ vacancy.salary_to|floatformat:0 }} {{ vacancy.salary_currency }}
                    {% elif vacancy.salary_from %}
                        –æ—Ç {{ vacancy.salary_from|floatformat:0 }} {{ vacancy.salary_currency }}
                    {% elif vacancy.salary_to %}
                        –¥–æ {{ vacancy.salary_to|floatformat:0 }} {{ vacancy.salary_currency }}
                    {% endif %}
                </p>
                {% endif %}
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                    {% if vacancy.experience %}
                    <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                        –û–ø—ã—Ç: {{ vacancy.experience }}
                    </span>
                    {% endif %}
                    {% if vacancy.employment %}
                    <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                        {{ vacancy.employment }}
                    </span>
                    {% endif %}
                    {% if vacancy.schedule %}
                    <span style="background: #e9ecef; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                        {{ vacancy.schedule }}
                    </span>
                    {% endif %}
                </div>
                
                {% if vacancy.description %}
                <p style="margin-top: 10px; color: #666; font-size: 14px; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                    {{ vacancy.description|striptags|truncatewords:30 }}
                </p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
    
    {% if page_obj.has_other_pages %}
    <div class="pagination">
        {% if page_obj.has_previous %}
        <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}{% if area_filter %}&area={{ area_filter }}{% endif %}{% if experience_filter %}&experience={{ experience_filter }}{% endif %}{% if employment_filter %}&employment={{ employment_filter }}{% endif %}{% if schedule_filter %}&schedule={{ schedule_filter }}{% endif %}{% if professional_role_filter %}&professional_role={{ professional_role_filter }}{% endif %}{% if salary_filter %}&salary={{ salary_filter }}{% endif %}">¬´ –ü–µ—Ä–≤–∞—è</a>
        <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if area_filter %}&area={{ area_filter }}{% endif %}{% if experience_filter %}&experience={{ experience_filter }}{% endif %}{% if employment_filter %}&employment={{ employment_filter }}{% endif %}{% if schedule_filter %}&schedule={{ schedule_filter }}{% endif %}{% if professional_role_filter %}&professional_role={{ professional_role_filter }}{% endif %}{% if salary_filter %}&salary={{ salary_filter }}{% endif %}">‚Äπ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}
        
        <span class="current">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if area_filter %}&area={{ area_filter }}{% endif %}{% if experience_filter %}&experience={{ experience_filter }}{% endif %}{% if employment_filter %}&employment={{ employment_filter }}{% endif %}{% if schedule_filter %}&schedule={{ schedule_filter }}{% endif %}{% if professional_role_filter %}&professional_role={{ professional_role_filter }}{% endif %}{% if salary_filter %}&salary={{ salary_filter }}{% endif %}">–°–ª–µ–¥—É—é—â–∞—è ‚Ä∫</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}{% if area_filter %}&area={{ area_filter }}{% endif %}{% if experience_filter %}&experience={{ experience_filter }}{% endif %}{% if employment_filter %}&employment={{ employment_filter }}{% endif %}{% if schedule_filter %}&schedule={{ schedule_filter }}{% endif %}{% if professional_role_filter %}&professional_role={{ professional_role_filter }}{% endif %}{% if salary_filter %}&salary={{ salary_filter }}{% endif %}">–ü–æ—Å–ª–µ–¥–Ω—è—è ¬ª</a>
        {% endif %}
    </div>
    {% endif %}
{% else %}
    <div class="card">
        <p style="text-align: center; color: #666; padding: 40px;">
            –í–∞–∫–∞–Ω—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã. 
            <a href="{% url 'vacancies:fetch_vacancies' %}">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –∏–∑ HH API</a>
        </p>
    </div>
{% endif %}
{% endblock %}

